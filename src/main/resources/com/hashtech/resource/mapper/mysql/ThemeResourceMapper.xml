<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hashtech.mapper.ThemeResourceMapper">

    <sql id="Base_Column_List">
        id               	as  id,
      name              as  name,
      sort              as  sort,
      create_time       as  createTime,
      create_by         as  createBy,
      update_time       as  updateTime,
      update_by         as  updateBy
    </sql>

    <select id="getMaxSort"
            resultType="java.lang.Integer">
        select ifnull(Max(sort), 0)
        from theme_resource
    </select>

    <select id="getMaxSortByParentId"
            resultType="java.lang.Integer">
        select ifnull(Max(sort), 0)
        from theme_resource where parent_id = #{parentId}
    </select>

    <select id="hasExitName"
            resultType="java.lang.Boolean">
        select 1
        from theme_resource
        <where>
            <if test="name != null and name != '' ">
                AND name = #{name}
            </if>
            AND del_flag = 'N'
            AND parent_id = '0'
        </where>
        limit 1
    </select>

    <select id="hasExitNameByResource"
            resultType="java.lang.Boolean">
        select 1
        from theme_resource
        <where>
            <if test="name != null and name != '' ">
                AND name = #{name}
            </if>
            AND del_flag = 'N'
            AND parent_id != '0'
        </where>
        limit 1
    </select>

    <update id="updateSort">
        update theme_resource
        <set>
            sort=#{sort}
        </set>
        <where>
            id=#{id}
        </where>
    </update>

    <update id="updateParentId">
        update theme_resource
        <set>
            parent_id=#{parentId}
        </set>
        <if test="ids != null and ids != ''">
            where id in
            <foreach collection="ids" item="i" open="(" close=")" separator=",">
                #{i}
            </foreach>
        </if>
    </update>

    <select id="queryPage" resultType="com.hashtech.web.result.ThemeResult">
        select
        <include refid="Base_Column_List" />
        from theme_resource where del_flag = 'N' order by sort desc
    </select>
    <select id="getResourceByParentId" resultType="com.hashtech.entity.ThemeResourceEntity">
        select
        *
        from theme_resource
        <where>
            <if test="parentId != null and parentId != '' ">
                AND parent_id = #{parentId}
            </if>
            AND del_flag = 'N'
            order by sort desc
        </where>
    </select>
</mapper>
