<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hashtech.mapper.IndustrialCompanyMapper">

    <select id="selectByIndustrialId"
            resultType="com.hashtech.entity.IndustrialCompanyEntity">
        select *
        from industrial_company_relation
        <where>
            <if test="industrialId != null and industrialId != '' ">
                AND industrial_id = #{industrialId}
            </if>
            AND del_flag = 0
        </where>
    </select>

    <select id="selectByIndustrialIds"
            resultType="com.hashtech.entity.IndustrialCompanyEntity">
        select *
        from industrial_company_relation
        <where>
            <if test="ids != null">
                AND industrial_id in
                <foreach collection="ids" item="i" open="(" close=")" separator=",">
                    #{i}
                </foreach>
            </if>
            AND del_flag = 0
        </where>
    </select>

    <select id="selectByIndustrialAndCompanyId"
            resultType="com.hashtech.entity.IndustrialCompanyEntity">
        select *
        from industrial_company_relation
        <where>
            <if test="industrialId != null and industrialId != '' ">
                AND industrial_id = #{industrialId}
            </if>
            <if test="companyInfoId != null and companyInfoId != '' ">
                AND company_info_id = #{companyInfoId}
            </if>
            AND del_flag = 0
        </where>
        limit 1
    </select>

    <select id="selectByCompanyId"
            resultType="com.hashtech.entity.IndustrialCompanyEntity">
        select *
        from industrial_company_relation
        <where>
            <if test="companyInfoId != null and companyInfoId != '' ">
                AND company_info_id = #{companyInfoId}
            </if>
            AND del_flag = 0
        </where>
    </select>

    <select id="selectByCompanyIds"
            resultType="com.hashtech.entity.IndustrialCompanyEntity">
        select *
        from industrial_company_relation
        <where>
            <if test="companyIdList != null">
                and company_info_id in
                <foreach collection="companyIdList" item="i" open="(" close=")" separator=",">
                    #{i}
                </foreach>
            </if>
            AND del_flag = 0
        </where>
    </select>

    <select id="hasExistByCompanyIdAndIndustrialIds"
            resultType="java.lang.Boolean">
        select 1
        from industrial_company_relation
        <where>
            <if test="companyInfoId != null and companyInfoId != '' ">
                AND company_info_id = #{companyInfoId}
            </if>
            <if test="industrialIds != null">
                and industrial_id in
                <foreach collection="industrialIds" item="i" open="(" close=")" separator=",">
                    #{i}
                </foreach>
            </if>
            AND del_flag = 0
        </where>
    </select>

    <select id="selectByRequest"
            resultType="com.hashtech.entity.IndustrialCompanyEntity">
        select * from industrial_company_relation where company_info_id in
        (SELECT ci.id FROM company_info ci
        INNER JOIN company_tag cg ON ci.id=cg.company_info_id
        <where>
            <if test="null!=request.tagId and request.tagId != '' ">
                AND cg.`tag_id` =#{request.tagId}
            </if>
            <if test="null!=request.uscc and request.uscc != '' ">
                AND ci.`uscc` LIKE CONCAT('%',#{request.uscc},'%')
            </if>
            <if test="null!=request.corpNm and request.corpNm != '' ">
                AND ci.`corp_nm` LIKE CONCAT('%',#{request.corpNm},'%')
            </if>
            AND ci.del_flag = 0 AND cg.del_flag = 0
        </where>
        ) and del_flag = 0
    </select>
</mapper>
